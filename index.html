<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON & Golang Struct Conversion</title>
    <style>
        .container {
            display: flex;
        }

        textarea,
        pre {
            width: 50%;
            padding: 1rem;
        }
    </style>
</head>

<body>
    <div class="container">
        <textarea id="input" placeholder="Enter JSON here"></textarea>
        <pre id="output"></pre>
    </div>

    <script>
        function capitalizeFirstLetter(string) {
            return string.charAt(0).toUpperCase() + string.slice(1);
        }

        function getRandomString(length) {
            const characters = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
            let result = "";
            for (let i = 0; i < length; i++) {
                result += characters.charAt(Math.floor(Math.random() * characters.length));
            }
            return result;
        }

        function getExampleValue(valueType) {
            switch (valueType) {
                case "string":
                    return getRandomString(20);
                case "int64":
                    return Math.floor(Math.random() * (Number.MAX_SAFE_INTEGER - Number.MIN_SAFE_INTEGER) + Number.MIN_SAFE_INTEGER);
                case "float64":
                    return (Math.random() * (Number.MAX_VALUE - (-Number.MAX_VALUE)) - Number.MAX_VALUE).toPrecision(15);
                case "bool":
                    return "true";
                default:
                    return "";
            }
        }

        function generateStruct(jsonObj, structName = "AutoGenerated", isInner = false, indent = "") {
            let result = isInner ? "" : `type ${structName} struct {\n`;

            for (const key in jsonObj) {
                const valueType = typeof jsonObj[key];
                let golangType = "";
                let exampleValue = "";
                let isBasicDataType = false;

                switch (valueType) {
                    case "string":
                        golangType = "string";
                        exampleValue = getExampleValue("string");
                        isBasicDataType = true;
                        break;
                    case "number":
                        golangType = Number.isInteger(jsonObj[key]) ? "int64" : "float64";
                        exampleValue = getExampleValue(golangType);
                        isBasicDataType = true;
                        break;
                    case "boolean":
                        golangType = "bool";
                        exampleValue = getExampleValue("bool");
                        isBasicDataType = true;
                        break;
                    case "object":
                        if (Array.isArray(jsonObj[key])) {
                            golangType = "[]struct {\n" + generateStruct(jsonObj[key][0], "", true, indent + "\t") + indent + "\t}";
                        } else {
                            golangType = 'struct {\n' + generateStruct(jsonObj[key], capitalizeFirstLetter(key), true, indent + "\t") + indent + '\t}';
                        }
                        break;
                }

                if (isBasicDataType) {
                    result += `${indent}\t${capitalizeFirstLetter(key)} ${golangType} \`json:"${key}" example:"${exampleValue}"\`\n`;
                } else {
                    result += `${indent}\t${capitalizeFirstLetter(key)} ${golangType} \`json:"${key}"\`\n`;
                }
            }

            if (!isInner) {
                result += "}\n";
            }
            return result;
        }

        document.getElementById("input").addEventListener("input", (e) => {
            try {
                const inputJson = JSON.parse(e.target.value);
                const outputStruct = generateStruct(inputJson);
                document.getElementById("output").innerText = outputStruct;
            } catch (err) {
                document.getElementById("output").innerText = "Invalid JSON input";
            }
        });

    </script>
</body>

</html>